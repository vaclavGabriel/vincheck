<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kontrola VIN kódu | VIN Info.cz</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <nav
      class="navbar navbar-expand-lg navbar-dark fixed-top"
      style="background-color: #c6dbad"
    >
      <div class="container-fluid">
        <a class="navbar-brand text-muted" href="/">VIN Info.cz</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active text-dark" aria-current="page" href="/"
                >Domů</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link text-muted"
                href="https://online.pojisteni.cz/vozidla/srovnani?ap=AWYPy1"
                target="_blank"
                >Povinné ručení</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link text-muted"
                href="https://online.pojisteni.cz/vozidla/srovnani?ap=AWYPy1"
                target="_blank"
                >Havarijní pojištění</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <h1>Kontrola VIN kódu</h1>
      <div class="row mt-3">
        <div class="col-md-6">
          <label for="vinInput" class="form-label">Zadejte VIN kód:</label>
          <input
            type="text"
            class="form-control"
            id="vinInput"
            placeholder="Např. WF0FXXWPCFHD05923"
          />
        </div>
        <div
          class="col-md-6 d-flex align-items-end justify-content-md-end mt-md-0 mt-3"
        >
          <button
            class="btn btn-primary w-100"
            onclick="getVehicleInfo()"
            id="getInfoBtn"
            disabled
          >
            Získat informace
          </button>
        </div>
      </div>
      <div id="vehicleInfo" class="mt-4"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      var btnTooltip = new bootstrap.Tooltip(
        document.getElementById("getInfoBtn"),
        {
          placement: "top",
          title: "Zadejte VIN kód o 17 znacích",
          trigger: "manual",
        }
      );

      function getVehicleInfo() {
        const vin = document.getElementById("vinInput").value;
        const url =
          "https://corsproxy.io/?" +
          encodeURIComponent(
            `https://www.dataovozidlech.cz/api/Vozidlo/GetVehicleInfo?vin=${vin}`
          );

        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            const infoDiv = document.createElement("div");
            infoDiv.classList.add("row", "mt-5", "mb-5", "align-items-center");

            const brandLogoSrc = getLogoSrc(
              data.find((item) => item.name === "TovarniZnacka")?.value
            );
            const brandLogoCol = document.createElement("div");
            brandLogoCol.classList.add("col-md-3", "text-center");
            const brandLogo = document.createElement("img");
            brandLogo.src = brandLogoSrc;
            brandLogo.alt = "Brand Logo";
            brandLogo.style.maxWidth = "200px";
            brandLogo.style.paddingRight = "40px";
            brandLogo.classList.add("img-fluid", "logo-img");
            brandLogoCol.appendChild(brandLogo);
            infoDiv.appendChild(brandLogoCol);

            const vehicleInfoCol = document.createElement("div");
            vehicleInfoCol.classList.add("col-md-4");
            const vehicleInfo = document.createElement("div");
            vehicleInfo.classList.add("vehicle-info");
            const brand =
              data.find((item) => item.name === "TovarniZnacka")?.value ||
              "Neznámá značka";
            const model =
              data.find((item) => item.name === "Typ")?.value ||
              "Neznámý model";
            const obchodniOznaceni =
              data.find((item) => item.name === "ObchodniOznaceni")?.value ||
              "";
            const firstRegistration =
              data.find((item) => item.name === "DatumPrvniRegistrace")
                ?.value || "Neznámé datum";
            const vinCode =
              data.find((item) => item.name === "VIN")?.value || "Neznámý VIN";
            vehicleInfo.innerHTML = `
                      <div><strong>Značka:</strong> ${brand}</div>
                      <div><strong>Model:</strong> ${model}</div>
                      <div><strong>Obchodní označení:</strong> ${obchodniOznaceni}</div>
                      <div><strong>Datum první registrace:</strong> ${firstRegistration}</div>
                      <div><strong>VIN:</strong> ${vinCode}</div>
                  `;
            vehicleInfoCol.appendChild(vehicleInfo);
            infoDiv.appendChild(vehicleInfoCol);

            const techInspectionCol = document.createElement("div");
            techInspectionCol.classList.add("col-md-4");
            const techInspection =
              data.find(
                (item) => item.name === "PravidelnaTechnickaProhlidkaDo"
              )?.value || "Neznámé datum";
            const techInspectionDiv = document.createElement("div");

            const povButtonDiv = document.createElement("div");

            const currentDate = new Date(); // Current date object

            // Parse the techInspection date string in the format "dd.MM.yyyy"
            const [day, month, year] = techInspection.split(".");
            const techInspectionDate = new Date(`${year}-${month}-${day}`);
            const techInspectionTime = techInspectionDate.getTime(); // Time in milliseconds

            const techInspectionDisplay = techInspection; // Display format is unchanged

            techInspectionDiv.innerHTML = `<strong>Pravidelná technická prohlídka do:</strong> <span style="color: ${
              techInspectionTime > currentDate.getTime() ? "green" : "red"
            }">${techInspectionDisplay}</span>`;
            techInspectionCol.appendChild(techInspectionDiv);

            povButtonDiv.innerHTML = `<a href="https://online.pojisteni.cz/vozidla/srovnani?ap=AWYPy1" class="btn btn-outline-primary w-90 mt-1 mb-1" role="button">Sjednat povinné ručení</a>
            <a href="https://online.pojisteni.cz/vozidla/srovnani?ap=AWYPy1" class="btn btn-outline-primary w-90 mt-1 mb-1" role="button">Sjednat havarijní pojištění</a>
            <br>
            <a href="https://cz.cebia.com/?vin=${vinCode}" class="btn btn-outline-primary w-100 mt-1 mb-1" role="button">Zobrazit historii vozu</a>
          `;

            techInspectionCol.appendChild(povButtonDiv);

            infoDiv.appendChild(techInspectionCol);

            const vehicleInfoContainer = document.getElementById("vehicleInfo");
            vehicleInfoContainer.innerHTML = "";
            vehicleInfoContainer.appendChild(infoDiv);

            let tableHtml = '<table class="table mt-4">';
            data.forEach((item) => {
              let itemValue = item.value;

              // Convert itemValue to string if it's not already a string
              if (typeof itemValue !== "string") {
                itemValue = String(itemValue);
              }

              // Check if itemValue contains "\n" and replace it with <br>
              if (itemValue.includes("\n")) {
                itemValue = itemValue.split("\n").join("<br>");
              }

              if (
                item.name !== "TovarniZnacka" &&
                item.name !== "Typ" &&
                item.name !== "DatumPrvniRegistrace" &&
                item.name !== "VIN" &&
                item.name !== "PravidelnaTechnickaProhlidkaDo" &&
                item.value !== ""
              ) {
                tableHtml += `<tr><th>${item.label}</th><td>${itemValue}</td></tr>`;
              }
            });
            tableHtml += "</table>";
            vehicleInfoContainer.innerHTML += tableHtml;
          })
          .catch((error) => {
            console.error("Chyba při načítání dat:", error);
            document.getElementById("vehicleInfo").innerHTML =
              '<p class="text-danger">Chyba při načítání dat. VIN pravděpodobně neexistuje v Registru silničních vozidel.<br>Zkontrolujte VIN kód a zkuste to znovu.</p>';
          });
      }

      function getLogoSrc(brand) {
        const brandLogos = {
          "ALFA-ROMEO": "logos/alfa-romeo.svg",
          AUDI: "logos/audi.svg",
          BMW: "logos/bmw.svg",
          CHEVROLET: "logos/chevrolet.svg",
          CITROEN: "logos/citroen.svg",
          CUPRA: "logos/cupra.svg",
          DACIA: "logos/dacia.svg",
          FERRARI: "logos/ferrari.svg",
          FIAT: "logos/fiat.svg",
          FORD: "logos/ford.svg",
          HONDA: "logos/honda.svg",
          HYUNDAI: "logos/hyundai.svg",
          KIA: "logos/kia.svg",
          LANCIA: "logos/lancia.svg",
          "LAND-ROVER": "logos/land-rover.svg",
          MAZDA: "logos/mazda.svg",
          "MERCEDES-BENZ": "logos/mercedes-benz.svg",
          MITSUBISHI: "logos/mitsubishi.svg",
          OPEN: "logos/opel.svg",
          PEUGEOT: "logos/peugeot.svg",
          PORSCHE: "logos/porsche.svg",
          RENAULT: "logos/renault.svg",
          SAAB: "logos/saab.svg",
          SEAT: "logos/seat.svg",
          SKODA: "logos/skoda.svg",
          ŠKODA: "logos/skoda.svg",
          TOYOTA: "logos/toyota.svg",
          VOLKSWAGEN: "logos/volkswagen.svg",
          VOLVO: "logos/volvo.svg",
        };

        return brandLogos[brand] || "logos/default_logo.svg";
      }

      const vinInput = document.getElementById("vinInput");
      const getInfoBtn = document.getElementById("getInfoBtn");

      vinInput.addEventListener("input", () => {
        getInfoBtn.disabled = vinInput.value.trim().length != 17;
      });

      getInfoBtn.addEventListener("mouseover", () => {
        if (getInfoBtn.disabled) {
          btnTooltip.show();
        }
      });

      vinInput.addEventListener("blur", () => {
        if (getInfoBtn.disabled) {
          btnTooltip.show();
        }
      });

      vinInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          event.preventDefault();
          getInfoBtn.click();
          btnTooltip.hide();
        }
      });

      getInfoBtn.addEventListener("mouseout", () => {
        btnTooltip.hide();
      });
    </script>
  </body>
</html>
